<div class="cart-wrapper py-5 mt-5 bg-light-subtle min-vh-100">
  <div class="container">
    <div class="d-flex align-items-center justify-content-between mb-5 animate-fade-in">
      <h2 class="fw-bold text-dark mb-0">
        <i class="fa-solid fa-basket-shopping text-success me-3"></i>Your Field Basket
      </h2>
      <span class="badge bg-success-subtle text-success rounded-pill px-3 py-2 border border-success border-opacity-25">
        {{ cartItems.length }} Items
      </span>
    </div>

    <div class="row g-4" *ngIf="cartItems.length > 0; else emptyCart">
      <div class="col-lg-8">
        <div class="card border-0 shadow-sm rounded-4 overflow-hidden animate-slide-up">
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead class="bg-light border-bottom">
                <tr class="text-uppercase small fw-bold text-muted ls-1">
                  <th class="px-4 py-4">Product</th>
                  <th class="py-4">Price</th>
                  <th class="py-4 text-center">Quantity</th>
                  <th class="py-4">Subtotal</th>
                  <th class="py-4 pe-4"></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of cartItems; let i = index" class="cart-item-row border-bottom">
                  <td class="px-4 py-4">
                    <div class="d-flex align-items-center gap-3">
                      <div class="product-img-frame bg-white rounded-3 shadow-sm p-1 border">
                        <img [src]="item.img" class="img-fluid" style="width: 65px; height: 65px; object-fit: contain;">
                      </div>
                      <div>
                        <h6 class="mb-1 fw-bold text-dark">{{ item.name }}</h6>
                        <span class="badge bg-success bg-opacity-10 text-success small border-0">In Stock</span>
                      </div>
                    </div>
                  </td>
                  <td class="py-4 fw-semibold text-secondary">₹{{ item.price | number }}</td>
                  <td class="py-4">
                    <div class="qty-control d-flex align-items-center justify-content-center mx-auto rounded-pill border p-1" style="max-width: 120px; background: #fdfdfd;">
                      <button class="btn btn-qty-pill shadow-none" (click)="updateQuantity(i, -1)">
                        <i class="fa-solid fa-minus fs-xs"></i>
                      </button>
                      <span class="fw-bold px-3">{{ item.quantity }}</span>
                      <button class="btn btn-qty-pill shadow-none" (click)="updateQuantity(i, 1)">
                        <i class="fa-solid fa-plus fs-xs"></i>
                      </button>
                    </div>
                  </td>
                  <td class="py-4 fw-bold text-success">₹{{ (item.price * item.quantity) | number }}</td>
                  <td class="py-4 text-end pe-4">
                    <button class="btn btn-remove-item rounded-circle" (click)="removeItem(i)">
                      <i class="fa-solid fa-trash-can"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="mt-4 animate-fade-in">
          <button routerLink="/Products" class="btn btn-link text-success fw-bold text-decoration-none px-0 btn-animated">
            <i class="fa-solid fa-arrow-left-long me-2"></i>Continue Shopping
          </button>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card border-0 shadow-lg rounded-4 p-4 sticky-top animate-slide-up summary-card" style="top: 100px;">
          <h5 class="fw-bold mb-4 text-dark d-flex align-items-center">
            Order Summary <i class="fa-solid fa-receipt ms-auto text-muted opacity-50"></i>
          </h5>

          <div class="summary-list">
            <div class="d-flex justify-content-between mb-3">
              <span class="text-secondary">Subtotal</span>
              <span class="fw-bold text-dark">₹{{ subtotal | number }}</span>
            </div>
            <div class="d-flex justify-content-between mb-3">
              <span class="text-secondary">Shipping Fees</span>
              <span class="text-success fw-bold">FREE <i class="fa-solid fa-truck-fast ms-1"></i></span>
            </div>
            <div class="d-flex justify-content-between mb-3">
              <span class="text-secondary">Tax (GST 5%)</span>
              <span class="fw-bold text-dark">₹{{ subtotal * 0.05 | number:'1.0-0' }}</span>
            </div>
          </div>

          <hr class="my-4 border-dashed">

          <div class="d-flex justify-content-between mb-4">
            <span class="h5 fw-normal text-dark mb-0">Payable Amount</span>
            <span class="h4 fw-bold text-success mb-0">₹{{ subtotal * 1.05 | number:'1.0-0' }}</span>
          </div>

          <button class="btn btn-success w-100 rounded-pill py-3 fw-bold shadow-lg btn-hover-grow mb-3">
            Checkout Securely <i class="fa-solid fa-lock ms-2"></i>
          </button>

          <div class="text-center bg-light p-3 rounded-3 border">
            <small class="text-muted"><i class="fa-solid fa-shield-check text-success me-1"></i> SSL Encrypted Farmer Payment</small>
            <div class="mt-2 d-flex justify-content-center gap-2 grayscale opacity-50">
               <i class="fa-brands fa-cc-visa fs-4"></i>
               <i class="fa-brands fa-cc-mastercard fs-4"></i>
               <i class="fa-solid fa-building-columns fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #emptyCart>
      <div class="text-center py-5 animate-fade-in mt-5">
        <div class="empty-cart-visual mb-4">
          <i class="fa-solid fa-basket-shopping text-success opacity-10" style="font-size: 10rem;"></i>
        </div>
        <h2 class="fw-bold text-dark">Your basket is currently empty</h2>
        <p class="text-muted fs-5">Looks like your field is waiting for some quality seeds or tools.</p>
        <button routerLink="/Products" class="btn btn-success btn-lg rounded-pill px-5 py-3 mt-4 shadow-lg fw-bold">
          Start Shopping
        </button>
      </div>
    </ng-template>
  </div>
</div>